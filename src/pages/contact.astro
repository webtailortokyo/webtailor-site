---
// お問い合わせページ
// フォーム入力 → 確認画面 → 送信 → サンクスページの流れを実装
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout 
  title="お問い合わせ"
  description="WEBテーラーへのお問い合わせフォーム。WEB制作のご依頼・ご相談はこちらからお気軽にどうぞ。"
  currentPath="/contact"
>
  <!-- ヒーローセクション -->
  <section class="pt-32 pb-16 bg-gradient-primary relative overflow-hidden">
    <!-- 装飾的な背景要素 -->
    <div class="absolute inset-0">
      <div class="absolute top-1/4 right-1/4 w-48 h-48 bg-white/5 rounded-full blur-2xl"></div>
      <div class="absolute bottom-1/4 left-1/4 w-32 h-32 bg-primary-300/20 rounded-full blur-xl"></div>
    </div>
    
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
      <div class="max-w-4xl mx-auto text-center space-y-6">
        <h1 class="text-4xl md:text-5xl font-bold text-accent-800 fade-in-up">
          お問い合わせ
        </h1>
        <p class="text-xl text-accent-600 fade-in-up" style="animation-delay: 0.2s;">
          WEB制作のご依頼・ご相談はお気軽にどうぞ
        </p>
        <div class="bg-white/80 p-6 rounded-xl max-w-2xl mx-auto fade-in-up" style="animation-delay: 0.4s;">
          <p class="text-neutral-700">
            <strong class="text-accent-700">無料相談・お見積もり</strong>を承っております。<br>
            プロジェクトの内容や規模に応じて柔軟に対応いたしますので、<br class="hidden sm:block">
            まずはお気軽にご相談ください。
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- お問い合わせフォームセクション -->
  <section class="section-padding bg-white">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-4xl mx-auto">
        <!-- フォーム -->
        <div class="bg-gradient-to-r from-primary-50/50 to-accent-50/50 p-8 md:p-12 rounded-2xl shadow-lg">
          <form id="contact-form" action="contact-process.php" method="POST" novalidate>
            <div class="space-y-8">
              <!-- お名前 -->
              <div class="fade-in-up">
                <label for="name" class="block text-lg font-semibold text-accent-800 mb-3">
                  お名前 <span class="text-red-500 text-base">*</span>
                </label>
                <input 
                  type="text" 
                  id="name" 
                  name="name" 
                  required
                  class="w-full px-4 py-3 border-2 border-primary-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-200 focus:outline-none transition-all duration-300 text-lg"
                  placeholder="例: 山田太郎"
                  aria-describedby="name-error"
                >
                <div id="name-error" class="text-red-600 text-sm mt-2 hidden"></div>
              </div>

              <!-- メールアドレス -->
              <div class="fade-in-up" style="animation-delay: 0.1s;">
                <label for="email" class="block text-lg font-semibold text-accent-800 mb-3">
                  メールアドレス <span class="text-red-500 text-base">*</span>
                </label>
                <input 
                  type="email" 
                  id="email" 
                  name="email" 
                  required
                  class="w-full px-4 py-3 border-2 border-primary-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-200 focus:outline-none transition-all duration-300 text-lg"
                  placeholder="例: contact@example.com"
                  aria-describedby="email-error"
                >
                <div id="email-error" class="text-red-600 text-sm mt-2 hidden"></div>
              </div>

              <!-- 電話番号 -->
              <div class="fade-in-up" style="animation-delay: 0.2s;">
                <label for="phone" class="block text-lg font-semibold text-accent-800 mb-3">
                  電話番号 <span class="text-neutral-500 text-base">(任意)</span>
                </label>
                <input 
                  type="tel" 
                  id="phone" 
                  name="phone"
                  class="w-full px-4 py-3 border-2 border-primary-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-200 focus:outline-none transition-all duration-300 text-lg"
                  placeholder="例: 090-1234-5678"
                >
              </div>

              <!-- 件名 -->
              <div class="fade-in-up" style="animation-delay: 0.3s;">
                <label for="subject" class="block text-lg font-semibold text-accent-800 mb-3">
                  件名 <span class="text-red-500 text-base">*</span>
                </label>
                <select 
                  id="subject" 
                  name="subject" 
                  required
                  class="w-full px-4 py-3 border-2 border-primary-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-200 focus:outline-none transition-all duration-300 text-lg"
                  aria-describedby="subject-error"
                >
                  <option value="">選択してください</option>
                  <option value="新規制作のご相談">新規制作のご相談</option>
                  <option value="既存サイトの修正・更新">既存サイトの修正・更新</option>
                  <option value="お見積もり依頼">お見積もり依頼</option>
                  <option value="WordPress関連">WordPress関連</option>
                  <option value="技術的なご相談">技術的なご相談</option>
                  <option value="その他">その他</option>
                </select>
                <div id="subject-error" class="text-red-600 text-sm mt-2 hidden"></div>
              </div>

              <!-- 予算 -->
              <div class="fade-in-up" style="animation-delay: 0.4s;">
                <label for="budget" class="block text-lg font-semibold text-accent-800 mb-3">
                  ご予算 <span class="text-neutral-500 text-base">(任意)</span>
                </label>
                <select 
                  id="budget" 
                  name="budget"
                  class="w-full px-4 py-3 border-2 border-primary-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-200 focus:outline-none transition-all duration-300 text-lg"
                >
                  <option value="">選択してください</option>
                  <option value="10万円未満">10万円未満</option>
                  <option value="10万円〜30万円">10万円〜30万円</option>
                  <option value="30万円〜50万円">30万円〜50万円</option>
                  <option value="50万円〜100万円">50万円〜100万円</option>
                  <option value="100万円以上">100万円以上</option>
                  <option value="時給制を希望">時給制を希望</option>
                  <option value="要相談">要相談</option>
                </select>
              </div>

              <!-- 希望納期 -->
              <div class="fade-in-up" style="animation-delay: 0.5s;">
                <label for="deadline" class="block text-lg font-semibold text-accent-800 mb-3">
                  希望納期 <span class="text-neutral-500 text-base">(任意)</span>
                </label>
                <select 
                  id="deadline" 
                  name="deadline"
                  class="w-full px-4 py-3 border-2 border-primary-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-200 focus:outline-none transition-all duration-300 text-lg"
                >
                  <option value="">選択してください</option>
                  <option value="1週間以内">1週間以内</option>
                  <option value="2週間以内">2週間以内</option>
                  <option value="1ヶ月以内">1ヶ月以内</option>
                  <option value="2ヶ月以内">2ヶ月以内</option>
                  <option value="3ヶ月以内">3ヶ月以内</option>
                  <option value="急ぎではない">急ぎではない</option>
                  <option value="相談したい">相談したい</option>
                </select>
              </div>

              <!-- メッセージ -->
              <div class="fade-in-up" style="animation-delay: 0.6s;">
                <label for="message" class="block text-lg font-semibold text-accent-800 mb-3">
                  メッセージ・ご要望 <span class="text-red-500 text-base">*</span>
                </label>
                <textarea 
                  id="message" 
                  name="message" 
                  rows="6" 
                  required
                  class="w-full px-4 py-3 border-2 border-primary-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-200 focus:outline-none transition-all duration-300 text-lg resize-vertical"
                  placeholder="プロジェクトの詳細、ご要望、ご質問などをお聞かせください。&#10;&#10;例:&#10;・コーポレートサイトの新規制作を検討しています&#10;・WordPressでブログ機能付きのサイトを作りたいです&#10;・既存サイトのスマホ対応をお願いしたいです"
                  aria-describedby="message-error"
                ></textarea>
                <div id="message-error" class="text-red-600 text-sm mt-2 hidden"></div>
                <div class="text-sm text-neutral-600 mt-2">
                  具体的なご要望をお聞かせいただけると、より正確なお見積もりが可能です
                </div>
              </div>

              <!-- プライバシー同意 -->
              <div class="fade-in-up" style="animation-delay: 0.7s;">
                <div class="flex items-start space-x-3">
                  <input 
                    type="checkbox" 
                    id="privacy" 
                    name="privacy" 
                    required
                    class="mt-1 w-5 h-5 text-primary-600 border-2 border-primary-200 rounded focus:ring-primary-200 focus:ring-2"
                    aria-describedby="privacy-error"
                  >
                  <label for="privacy" class="text-neutral-700 leading-relaxed">
                    <a href="/privacy" target="_blank" class="text-primary-600 hover:text-primary-700 underline">プライバシーポリシー</a>に同意する <span class="text-red-500">*</span>
                  </label>
                </div>
                <div id="privacy-error" class="text-red-600 text-sm mt-2 hidden"></div>
              </div>

              <!-- 送信ボタン -->
              <div class="text-center pt-6 fade-in-up" style="animation-delay: 0.8s;">
                <button 
                  type="submit"
                  class="btn-gradient text-lg px-12 py-4 hover:shadow-xl transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                  id="submit-btn"
                >
                  <span id="submit-text">確認画面へ進む</span>
                  <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                </button>
                <p class="text-sm text-neutral-600 mt-4">
                  ご返信には数営業日いただく場合がございます
                </p>
              </div>
            </div>
          </form>
        </div>

        <!-- 直接連絡先 -->
        <div class="mt-16 text-center">
          <h3 class="text-2xl font-bold text-accent-800 mb-8">直接のご連絡</h3>
          <div class="grid md:grid-cols-2 gap-8 max-w-2xl mx-auto">
            <div class="glass-effect p-6 rounded-xl">
              <div class="w-16 h-16 bg-gradient-to-r from-primary-100 to-primary-200 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-primary-600" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                  <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                </svg>
              </div>
              <h4 class="font-bold text-accent-800 mb-2">メール</h4>
              <a href="mailto:contact@webtailor.jp" class="text-primary-600 hover:text-primary-700 font-medium transition-colors duration-200">
                contact@webtailor.jp
              </a>
            </div>
            <div class="glass-effect p-6 rounded-xl">
              <div class="w-16 h-16 bg-gradient-to-r from-accent-100 to-accent-200 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-accent-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                </svg>
              </div>
              <h4 class="font-bold text-accent-800 mb-2">営業時間</h4>
              <p class="text-neutral-700">平日 9:00-17:00</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<!-- フォーム用JavaScript -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const submitBtn = document.getElementById('submit-btn');
    const submitText = document.getElementById('submit-text');
    const loadingSpinner = document.getElementById('loading-spinner');
    
    // フォームバリデーション
    function validateForm() {
      let isValid = true;
      
      // 必須項目のチェック
      const requiredFields = ['name', 'email', 'subject', 'message'];
      
      requiredFields.forEach(field => {
        const input = document.getElementById(field);
        const errorDiv = document.getElementById(field + '-error');
        
        if (!input.value.trim()) {
          errorDiv.textContent = 'この項目は必須です。';
          errorDiv.classList.remove('hidden');
          input.classList.add('border-red-500');
          isValid = false;
        } else {
          errorDiv.classList.add('hidden');
          input.classList.remove('border-red-500');
        }
      });
      
      // メールアドレス形式のチェック
      const email = document.getElementById('email');
      const emailError = document.getElementById('email-error');
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      if (email.value && !emailPattern.test(email.value)) {
        emailError.textContent = '正しいメールアドレスの形式で入力してください。';
        emailError.classList.remove('hidden');
        email.classList.add('border-red-500');
        isValid = false;
      }
      
      // プライバシーポリシー同意のチェック
      const privacy = document.getElementById('privacy');
      const privacyError = document.getElementById('privacy-error');
      
      if (!privacy.checked) {
        privacyError.textContent = 'プライバシーポリシーに同意してください。';
        privacyError.classList.remove('hidden');
        isValid = false;
      } else {
        privacyError.classList.add('hidden');
      }
      
      return isValid;
    }
    
    // リアルタイムバリデーション
    ['name', 'email', 'subject', 'message'].forEach(field => {
      const input = document.getElementById(field);
      input.addEventListener('blur', function() {
        const errorDiv = document.getElementById(field + '-error');
        
        if (!this.value.trim()) {
          errorDiv.textContent = 'この項目は必須です。';
          errorDiv.classList.remove('hidden');
          this.classList.add('border-red-500');
        } else {
          errorDiv.classList.add('hidden');
          this.classList.remove('border-red-500');
          
          // メールアドレスの場合は形式もチェック
          if (field === 'email') {
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailPattern.test(this.value)) {
              errorDiv.textContent = '正しいメールアドレスの形式で入力してください。';
              errorDiv.classList.remove('hidden');
              this.classList.add('border-red-500');
            }
          }
        }
      });
    });
    
    // フォーム送信時の処理
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      if (!validateForm()) {
        // エラーがある場合は先頭のエラー項目にスクロール
        const firstError = document.querySelector('.border-red-500, .text-red-600:not(.hidden)');
        if (firstError) {
          firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        return;
      }
      
      // ローディング状態にする
      submitBtn.disabled = true;
      submitText.classList.add('hidden');
      loadingSpinner.classList.remove('hidden');
      
      // フォームデータを準備
      const formData = new FormData(form);
      
      // 確認画面用のデータをセッションストレージに保存
      const formObject = {};
      formData.forEach((value, key) => {
        formObject[key] = value;
      });
      sessionStorage.setItem('contactFormData', JSON.stringify(formObject));
      
      // 確認画面に遷移
      setTimeout(() => {
        window.location.href = '/contact-confirm';
      }, 500);
    });
    
    // 入力時の装飾効果
    const inputs = document.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
      input.addEventListener('focus', function() {
        this.parentNode.classList.add('scale-[1.02]');
      });
      
      input.addEventListener('blur', function() {
        this.parentNode.classList.remove('scale-[1.02]');
      });
    });
  });
</script>

<style>
  /* フォーム要素の装飾 */
  .form-group {
    transition: all 0.3s ease;
  }
  
  input:focus, select:focus, textarea:focus {
    box-shadow: 0 0 0 3px rgba(34, 204, 240, 0.1);
  }
  
  /* カスタムチェックボックス */
  input[type="checkbox"]:checked {
    background-color: #22ccf0;
    border-color: #22ccf0;
  }
  
  /* アニメーション効果の改善 */
  .fade-in-up {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease-out forwards;
  }
  
  /* レスポンシブ対応 */
  @media (max-width: 768px) {
    .section-padding {
      padding: 3rem 0;
    }
    
    form .space-y-8 > * {
      margin-bottom: 1.5rem;
    }
  }
</style>